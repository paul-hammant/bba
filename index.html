<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0"/>
    <meta name="theme-color" content="#EE6E73">
    <title>Branch By Abstraction</title>
    <script
            src="https://code.jquery.com/jquery-3.2.1.min.js"
            integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
            crossorigin="anonymous"></script>

    <!--Import Google Icon Font-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/css/materialize.min.css">

    <!-- Compiled and minified JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/js/materialize.min.js"></script>

    <style>
        /*h1 {*/
            /*font-size: 22pt;*/
        /*}*/
        /*p {*/
            /*font-size: 150%;*/
        /*}*/

        nav ul a {
            color: #96a5b2;
        }

        nav ul li.active a {
            color: white;
        }

        /* From a picture frame codepen - https://codepen.io/PaFF/pen/khydI ... */

        .picture {
            position: relative;
            float: left;
            margin: 0 20px 25px 20px;
        }

        .hook {
            width: 5px;
            height: 5px;
            background-color: #2F4F4F;
            margin: 0 auto 32px auto;
            border-radius: 50%;
            box-shadow: 0 1px 0 1px #a49c7c;
        }

        @media all and (max-width: 620px) {
            .hook:before {
                left: 46.3%;
                border: 2px #a49c7c;
            }
        }
        @media all and (min-width: 621px) and (max-width: 800px) {
            .hook:before {
                left: 46.8%;
                border: 2px #a49c7c;
            }
        }
        @media all and (min-width: 801px) and (max-width: 900px) {
            .hook:before {
                left: 47.2%;
                border: 2px #a49c7c;
            }
        }
        @media all and (min-width: 901px) and (max-width: 1200px) {
            .hook:before {
                left: 47.3%;
                border: 2px #a49c7c;
            }
        }
        @media all and (min-width: 1201px) {
            .hook:before {
                left: 47.7%;
                border: 2px #a49c7c;
            }
        }

        .hook:before {
            content: '';
            width: 43px;
            height: 43px;
            /*border: 2px #a49c7c;*/
            border-style: solid hidden hidden solid;
            position: absolute;

            top: 13px;
            transform: rotate(45deg);
        }

        .frame {
            border-top: 6px solid #b89675;
            border-right: 6px solid #7b654f;
            border-bottom: 6px solid #7b654f;
            border-left: 6px solid #a67c52;
            box-shadow: 4px 4px 0 0 rgba(189, 166, 72, 0.6);
            z-index: 1;
        }

        .inside {
            background: linear-gradient(149deg, #d3d4d5 0%, #d3d4d5 50%, #ccc 51%, #ccc 100%);
            border: 10px solid #fff;
            box-shadow: 1px 1px 1px 1px rgba(189, 193, 194, 0.3) inset;
        }

        .page-footer {
            color: black;
            background-color: white
        }

        .page-footer .footer-copyright {
            color: black;
            background-color:aliceblue
        }
    </style>

</head>
<body style="background-color: aliceblue">

<main>
<div class="container" style="background-color: white; padding-left: 10px; padding-right: 10px; padding-top: 5px; margin-top: 15px; margin-bottom: 15px; padding-bottom: 15px">

    <div class="wrapper">
        <div class="picture">
            <div class="nail"></div>
            <div class="hook"></div>
            <div class="frame">
                <div class="inside">
                    <img alt="Abstract Branch by Paul Hammant" height="auto" width="100%" src="abstract_branch.png" />
                </div>
            </div>
        </div>
    </div>


    <h2 align="center">Branch By Abstraction?</h2>

    <p class="flow-text">Yes, <b>by abstraction instead of by branches in source control</b>. And no, that doesn't mean sprinkle
        conditionals into your source code, it means to use an abstraction concept that's idiomatic for the language in question.</p>

    <p class="flow-text"><u>Context:</u> Some non-functional changes are so quick to code that the migration barely register in the
        dev team. Some are so long that they're
        going to be inconvenient for the concurrent development of normal functional deliverables. Specifically, the non-functional changes
        that impact many parts of the codebase that might risk breaking the build repeatedly over the weeks/months needed to complete them.</p>

    <p class="flow-text">Branch by Abstraction is a methodical procedure. You would introduce an abstraction to methodically
        chomp away at the non-functional
    change that you're needing to complete. While not jeopardizing anyone else's throughput you complete your work, switch
    over in production and then <b>take out the abstraction</b>. That's the characterizing difference between the methodical branch by
    abstraction procedure and and regular the many regular abstractions that you've put into your codebase. Oh, and the removal of the abstraction (and old implementation) is the analog of the merge back from the branch you've now avoided.</p>

    <p class="flow-text">Here are the steps of the methodical procedure illustrated using <span>UML sequence diagrams</span>:</p>

    <div class="row">
        <form class="col s12">
            <div class="input-field col s12 m6">
                <select>
                    <optgroup label="non-language centric">
                        <option value="seqdiag">UML sequence diagram</option>
                    </optgroup>
                    <optgroup label="Language centric">
                        <option value="java">Java</option>
                        <option value="ruby">Ruby</option>
                    </optgroup>
                </select>
                <label>Illustrate concepts using:</label>
            </div>

        </form>
    </div>

    <h2>1. Identify the change that will take a while</h2>

    <p class="flow-text">The classic case discussed for branch by abstraction is the changing of one persistence technology for another. In the original
        article, it was swapping out Java's 'Hibernate' technology for 'iBatis' (now MyBatis). That was hypothetical for the blog entry. In real
        life, a few years later ThoughtWorks' Go team replaced iBatis with Hibernate (life indeed imitates art <i>Oscar Wilde</i>). </p>

    <p class="flow-text">For this telling of the branch by abstraction story, let's revisit the non-functional and time-consuming swap persistence
        technology A for B. A being the old undesired tech, and B being the new hotness.  For the hypothetical app, there are
        hundreds of components that use the same lib/framework and follow its applicable patterns. Only the business name for those
        persistable things would last.  Let's start with "ShoppingCart" because it is tangible to most readers.</p>

    <svg xmlns="http://www.w3.org/2000/svg" width="566" height="487" xmlns:xlink="http://www.w3.org/1999/xlink"><source><![CDATA[Add To\nShoppingCart\nRoute -> Shopping\nCart: addItem
        Shopping\nCart->Your\nPersistence\nTech: getDao
        Your\nPersistence\nTech->Shopping\nCart DAO: findOrCreate
        Shopping\nCart DAO->Shopping\nCart: here it is
        Shopping\nCart->Shopping\nCart DAO: save this
        Shopping\nCart DAO->Shopping\nCart: yup, saved
        Shopping\nCart->Add To\nShoppingCart\nRoute: added]]></source><desc></desc><defs><marker viewBox="0 0 5 5" markerWidth="5" markerHeight="5" orient="auto" refX="5" refY="2.5" id="markerArrowBlock"><path d="M 0 0 L 5 2.5 L 0 5 z"></path></marker><marker viewBox="0 0 9.6 16" markerWidth="4" markerHeight="16" orient="auto" refX="9.6" refY="8" id="markerArrowOpen"><path d="M 9.6,8 1.9,16 0,13.7 5.7,8 0,2.2 1.9,0 9.6,8 z"></path></marker></defs><g class="title"></g><g class="actor"><rect x="10" y="20" width="137.1" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="21" y="45" ><tspan x="20">Add To</tspan><tspan dy="1.2em" x="20">ShoppingCart</tspan><tspan dy="1.2em" x="20">Route</tspan></text></g><g class="actor"><rect x="10" y="390.4" width="137.1" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="21" y="415.4" ><tspan x="20">Add To</tspan><tspan dy="1.2em" x="20">ShoppingCart</tspan><tspan dy="1.2em" x="20">Route</tspan></text></g><line x1="78.5" x2="78.5" y1="97.4" y2="390.4" style="stroke-width: 2;" stroke="#000000" fill="none"></line><g class="actor"><rect x="167.1" y="20" width="98.8" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="178.1" y="54.6" ><tspan x="177.1">Shopping</tspan><tspan dy="1.2em" x="177.1">Cart</tspan></text></g><g class="actor"><rect x="167.1" y="390.4" width="98.8" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="178.1" y="425.0" ><tspan x="177.1">Shopping</tspan><tspan dy="1.2em" x="177.1">Cart</tspan></text></g><line x1="216.5" x2="216.5" y1="97.4" y2="390.4" style="stroke-width: 2;" stroke="#000000" fill="none"></line><g class="actor"><rect x="286" y="20" width="127.5" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="297" y="45" ><tspan x="296">Your</tspan><tspan dy="1.2em" x="296">Persistence</tspan><tspan dy="1.2em" x="296">Tech</tspan></text></g><g class="actor"><rect x="286" y="390.4" width="127.5" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="297" y="415.4" ><tspan x="296">Your</tspan><tspan dy="1.2em" x="296">Persistence</tspan><tspan dy="1.2em" x="296">Tech</tspan></text></g><line x1="349.7" x2="349.7" y1="97.4" y2="390.4" style="stroke-width: 2;" stroke="#000000" fill="none"></line><g class="actor"><rect x="437.5" y="20" width="98.8" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="448.5" y="54.6" ><tspan x="447.5">Shopping</tspan><tspan dy="1.2em" x="447.5">Cart DAO</tspan></text></g><g class="actor"><rect x="437.5" y="390.4" width="98.8" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="448.5" y="425.0" ><tspan x="447.5">Shopping</tspan><tspan dy="1.2em" x="447.5">Cart DAO</tspan></text></g><line x1="486.9" x2="486.9" y1="97.4" y2="390.4" style="stroke-width: 2;" stroke="#000000" fill="none"></line><g class="signal"><text x="114" y="127.9" ><tspan x="113">addItem</tspan></text><line x1="78.5" x2="216.5" y1="136.4" y2="136.4" style="stroke-width: 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="254.3" y="166.9" ><tspan x="253.3">getDao</tspan></text><line x1="216.5" x2="349.7" y1="175.4" y2="175.4" style="stroke-width: 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="360.7" y="205.9" ><tspan x="359.7">findOrCreate</tspan></text><line x1="349.7" x2="486.9" y1="214.4" y2="214.4" style="stroke-width: 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="303.7" y="244.9" ><tspan x="302.7">here it is</tspan></text><line x1="486.9" x2="216.5" y1="253.4" y2="253.4" style="stroke-width: 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="308.5" y="283.9" ><tspan x="307.5">save this</tspan></text><line x1="216.5" x2="486.9" y1="292.4" y2="292.4" style="stroke-width: 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="303.7" y="322.9" ><tspan x="302.7">yup, saved</tspan></text><line x1="486.9" x2="216.5" y1="331.4" y2="331.4" style="stroke-width: 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="123.5" y="361.9" ><tspan x="122.5">added</tspan></text><line x1="216.5" x2="78.5" y1="370.4" y2="370.4" style="stroke-width: 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g></svg>

    <h2>2. Introduce an abstraction</h2>

    <p class="flow-text">
        Somewhere primordial you'd introduce a new component. A single place that allowed the caller to not know whether
        they were using the old or the new ShoppingCart persistence capability. At boot time the choice of old or new for
        ShoppingCart persistence would be determined. Some development teams might make that a compile-time fixed choice.
        Those wouldn't be relying on compiler directives (#IFDEF), but one something closer to the build grammar and also
        a mechnism of abstraction that is idiomatically correct for the language in question. For example Java's interfaces
        and implementations
        are a smarter choices than making a base class for 'old' and 'new' to extend. C# would be the same. Ruby and Python
        have mixins and method_missing to consider, and a number of duck-typing possibilities. Rust has traits which the
        team could consider.
    </p>

    <p class="flow-text">What is unlikely, though is run-time toggles. Those are toggles/flags that can be flipped from old to new (or back
        again), while the software is in use. Unlikely but not impossible.</p>

    <svg xmlns="http://www.w3.org/2000/svg" width="733" height="565" xmlns:xlink="http://www.w3.org/1999/xlink"><source><![CDATA[Add To\nShoppingCart\nRoute -> Shopping\nCart: addItem
        Shopping\nCart->Temporary\nAbstraction.\n(ormToggle=?): addItem
        Temporary\nAbstraction.\n(ormToggle=?)->Your\nPersistence\nTech: getDao
        Your\nPersistence\nTech->Shopping\nCart DAO: findOrCreate
        Shopping\nCart DAO->Temporary\nAbstraction.\n(ormToggle=?): here it is
        Temporary\nAbstraction.\n(ormToggle=?)->Shopping\nCart DAO: save this
        Shopping\nCart DAO->Temporary\nAbstraction.\n(ormToggle=?): yup, saved
        Temporary\nAbstraction.\n(ormToggle=?)->Shopping\nCart: added
        Shopping\nCart->Add To\nShoppingCart\nRoute: added]]></source><desc></desc><defs><marker viewBox="0 0 5 5" markerWidth="5" markerHeight="5" orient="auto" refX="5" refY="2.5" id="markerArrowBlock"><path d="M 0 0 L 5 2.5 L 0 5 z"></path></marker><marker viewBox="0 0 9.6 16" markerWidth="4" markerHeight="16" orient="auto" refX="9.6" refY="8" id="markerArrowOpen"><path d="M 9.6,8 1.9,16 0,13.7 5.7,8 0,2.2 1.9,0 9.6,8 z"></path></marker></defs><g class="title"></g><g class="actor"><rect x="10" y="20" width="137.1" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="21" y="45" ><tspan x="20">Add To</tspan><tspan dy="1.2em" x="20">ShoppingCart</tspan><tspan dy="1.2em" x="20">Route</tspan></text></g><g class="actor"><rect x="10" y="468.4" width="137.1" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="21" y="493.4" ><tspan x="20">Add To</tspan><tspan dy="1.2em" x="20">ShoppingCart</tspan><tspan dy="1.2em" x="20">Route</tspan></text></g><line x1="78.5" x2="78.5" y1="97.4" y2="468.4" style="stroke-width: 2;" stroke="#000000" fill="none"></line><g class="actor"><rect x="167.1" y="20" width="98.8" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="178.1" y="54.6" ><tspan x="177.1">Shopping</tspan><tspan dy="1.2em" x="177.1">Cart</tspan></text></g><g class="actor"><rect x="167.1" y="468.4" width="98.8" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="178.1" y="503.0" ><tspan x="177.1">Shopping</tspan><tspan dy="1.2em" x="177.1">Cart</tspan></text></g><line x1="216.5" x2="216.5" y1="97.4" y2="468.4" style="stroke-width: 2;" stroke="#000000" fill="none"></line><g class="actor"><rect x="286" y="20" width="146.8" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="297" y="45" ><tspan x="296">Temporary</tspan><tspan dy="1.2em" x="296">Abstraction.</tspan><tspan dy="1.2em" x="296">(ormToggle=?)</tspan></text></g><g class="actor"><rect x="286" y="468.4" width="146.8" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="297" y="493.4" ><tspan x="296">Temporary</tspan><tspan dy="1.2em" x="296">Abstraction.</tspan><tspan dy="1.2em" x="296">(ormToggle=?)</tspan></text></g><line x1="359.4" x2="359.4" y1="97.4" y2="468.4" style="stroke-width: 2;" stroke="#000000" fill="none"></line><g class="actor"><rect x="452.8" y="20" width="127.5" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="463.8" y="45" ><tspan x="462.8">Your</tspan><tspan dy="1.2em" x="462.8">Persistence</tspan><tspan dy="1.2em" x="462.8">Tech</tspan></text></g><g class="actor"><rect x="452.8" y="468.4" width="127.5" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="463.8" y="493.4" ><tspan x="462.8">Your</tspan><tspan dy="1.2em" x="462.8">Persistence</tspan><tspan dy="1.2em" x="462.8">Tech</tspan></text></g><line x1="516.6" x2="516.6" y1="97.4" y2="468.4" style="stroke-width: 2;" stroke="#000000" fill="none"></line><g class="actor"><rect x="604.3" y="20" width="98.8" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="615.3" y="54.6" ><tspan x="614.3">Shopping</tspan><tspan dy="1.2em" x="614.3">Cart DAO</tspan></text></g><g class="actor"><rect x="604.3" y="468.4" width="98.8" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="615.3" y="503.0" ><tspan x="614.3">Shopping</tspan><tspan dy="1.2em" x="614.3">Cart DAO</tspan></text></g><line x1="653.7" x2="653.7" y1="97.4" y2="468.4" style="stroke-width: 2;" stroke="#000000" fill="none"></line><g class="signal"><text x="114" y="127.9" ><tspan x="113">addItem</tspan></text><line x1="78.5" x2="216.5" y1="136.4" y2="136.4" style="stroke-width: 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="254.4" y="166.9" ><tspan x="253.4">addItem</tspan></text><line x1="216.5" x2="359.4" y1="175.4" y2="175.4" style="stroke-width: 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="409.2" y="205.9" ><tspan x="408.2">getDao</tspan></text><line x1="359.4" x2="516.6" y1="214.4" y2="214.4" style="stroke-width: 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="527.6" y="244.9" ><tspan x="526.6">findOrCreate</tspan></text><line x1="516.6" x2="653.7" y1="253.4" y2="253.4" style="stroke-width: 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="458.6" y="283.9" ><tspan x="457.6">here it is</tspan></text><line x1="653.7" x2="359.4" y1="292.4" y2="292.4" style="stroke-width: 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="463.3" y="322.9" ><tspan x="462.3">save this</tspan></text><line x1="359.4" x2="653.7" y1="331.4" y2="331.4" style="stroke-width: 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="458.6" y="361.9" ><tspan x="457.6">yup, saved</tspan></text><line x1="653.7" x2="359.4" y1="370.4" y2="370.4" style="stroke-width: 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="264" y="400.9" ><tspan x="263">added</tspan></text><line x1="359.4" x2="216.5" y1="409.4" y2="409.4" style="stroke-width: 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="123.5" y="439.9" ><tspan x="122.5">added</tspan></text><line x1="216.5" x2="78.5" y1="448.4" y2="448.4" style="stroke-width: 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g></svg>

    <h2>3. Sensible renames</h2>

    <svg xmlns="http://www.w3.org/2000/svg" width="733" height="565" xmlns:xlink="http://www.w3.org/1999/xlink"><source><![CDATA[Add To\nShoppingCart\nRoute -> Shopping\nCart: addItem
        Shopping\nCart->Temporary\nAbstraction\n(ormToggle=?): addItem
        Temporary\nAbstraction\n(ormToggle=?)->Legacy.\nPersistence\nTech: getDao
        Legacy.\nPersistence\nTech->Legacy.\nShopping\nCart DAO: findOrCreate
        Legacy.\nShopping\nCart DAO->Temporary\nAbstraction\n(ormToggle=?): here it is
        Temporary\nAbstraction\n(ormToggle=?)->Legacy.\nShopping\nCart DAO: save this
        Legacy.\nShopping\nCart DAO->Temporary\nAbstraction\n(ormToggle=?): yup, saved
        Temporary\nAbstraction\n(ormToggle=?)->Shopping\nCart: added
        Shopping\nCart->Add To\nShoppingCart\nRoute: added]]></source><desc></desc><defs><marker viewBox="0 0 5 5" markerWidth="5" markerHeight="5" orient="auto" refX="5" refY="2.5" id="markerArrowBlock"><path d="M 0 0 L 5 2.5 L 0 5 z"></path></marker><marker viewBox="0 0 9.6 16" markerWidth="4" markerHeight="16" orient="auto" refX="9.6" refY="8" id="markerArrowOpen"><path d="M 9.6,8 1.9,16 0,13.7 5.7,8 0,2.2 1.9,0 9.6,8 z"></path></marker></defs><g class="title"></g><g class="actor"><rect x="10" y="20" width="137.1" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="21" y="45" ><tspan x="20">Add To</tspan><tspan dy="1.2em" x="20">ShoppingCart</tspan><tspan dy="1.2em" x="20">Route</tspan></text></g><g class="actor"><rect x="10" y="468.4" width="137.1" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="21" y="493.4" ><tspan x="20">Add To</tspan><tspan dy="1.2em" x="20">ShoppingCart</tspan><tspan dy="1.2em" x="20">Route</tspan></text></g><line x1="78.5" x2="78.5" y1="97.4" y2="468.4" style="stroke-width: 2;" stroke="#000000" fill="none"></line><g class="actor"><rect x="167.1" y="20" width="98.8" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="178.1" y="54.6" ><tspan x="177.1">Shopping</tspan><tspan dy="1.2em" x="177.1">Cart</tspan></text></g><g class="actor"><rect x="167.1" y="468.4" width="98.8" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="178.1" y="503.0" ><tspan x="177.1">Shopping</tspan><tspan dy="1.2em" x="177.1">Cart</tspan></text></g><line x1="216.5" x2="216.5" y1="97.4" y2="468.4" style="stroke-width: 2;" stroke="#000000" fill="none"></line><g class="actor"><rect x="286" y="20" width="146.8" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="297" y="45" ><tspan x="296">Temporary</tspan><tspan dy="1.2em" x="296">Abstraction</tspan><tspan dy="1.2em" x="296">(ormToggle=?)</tspan></text></g><g class="actor"><rect x="286" y="468.4" width="146.8" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="297" y="493.4" ><tspan x="296">Temporary</tspan><tspan dy="1.2em" x="296">Abstraction</tspan><tspan dy="1.2em" x="296">(ormToggle=?)</tspan></text></g><line x1="359.4" x2="359.4" y1="97.4" y2="468.4" style="stroke-width: 2;" stroke="#000000" fill="none"></line><g class="actor"><rect x="452.8" y="20" width="127.5" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="463.8" y="45" ><tspan x="462.8">Legacy.</tspan><tspan dy="1.2em" x="462.8">Persistence</tspan><tspan dy="1.2em" x="462.8">Tech</tspan></text></g><g class="actor"><rect x="452.8" y="468.4" width="127.5" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="463.8" y="493.4" ><tspan x="462.8">Legacy.</tspan><tspan dy="1.2em" x="462.8">Persistence</tspan><tspan dy="1.2em" x="462.8">Tech</tspan></text></g><line x1="516.6" x2="516.6" y1="97.4" y2="468.4" style="stroke-width: 2;" stroke="#000000" fill="none"></line><g class="actor"><rect x="604.3" y="20" width="98.8" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="615.3" y="45" ><tspan x="614.3">Legacy.</tspan><tspan dy="1.2em" x="614.3">Shopping</tspan><tspan dy="1.2em" x="614.3">Cart DAO</tspan></text></g><g class="actor"><rect x="604.3" y="468.4" width="98.8" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="615.3" y="493.4" ><tspan x="614.3">Legacy.</tspan><tspan dy="1.2em" x="614.3">Shopping</tspan><tspan dy="1.2em" x="614.3">Cart DAO</tspan></text></g><line x1="653.7" x2="653.7" y1="97.4" y2="468.4" style="stroke-width: 2;" stroke="#000000" fill="none"></line><g class="signal"><text x="114" y="127.9" ><tspan x="113">addItem</tspan></text><line x1="78.5" x2="216.5" y1="136.4" y2="136.4" style="stroke-width: 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="254.4" y="166.9" ><tspan x="253.4">addItem</tspan></text><line x1="216.5" x2="359.4" y1="175.4" y2="175.4" style="stroke-width: 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="409.2" y="205.9" ><tspan x="408.2">getDao</tspan></text><line x1="359.4" x2="516.6" y1="214.4" y2="214.4" style="stroke-width: 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="527.6" y="244.9" ><tspan x="526.6">findOrCreate</tspan></text><line x1="516.6" x2="653.7" y1="253.4" y2="253.4" style="stroke-width: 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="458.6" y="283.9" ><tspan x="457.6">here it is</tspan></text><line x1="653.7" x2="359.4" y1="292.4" y2="292.4" style="stroke-width: 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="463.3" y="322.9" ><tspan x="462.3">save this</tspan></text><line x1="359.4" x2="653.7" y1="331.4" y2="331.4" style="stroke-width: 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="458.6" y="361.9" ><tspan x="457.6">yup, saved</tspan></text><line x1="653.7" x2="359.4" y1="370.4" y2="370.4" style="stroke-width: 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="264" y="400.9" ><tspan x="263">added</tspan></text><line x1="359.4" x2="216.5" y1="409.4" y2="409.4" style="stroke-width: 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="123.5" y="439.9" ><tspan x="122.5">added</tspan></text><line x1="216.5" x2="78.5" y1="448.4" y2="448.4" style="stroke-width: 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g></svg>

    <h2>4. Only the devs working on the migration are exposed to the new technology, in a crucial primordial section of code.</h2>

    <p class="flow-text">This is because there's a single toggle/flag flipped for those developers.</p>

    <svg xmlns="http://www.w3.org/2000/svg" width="1014" height="605" xmlns:xlink="http://www.w3.org/1999/xlink"><source><![CDATA[Add To\nShoppingCart\nRoute -> Shopping\nCart: addItem
        Shopping\nCart->Temporary\nAbstraction\n(ormToggle=new): addItem
        Temporary\nAbstraction\n(ormToggle=new)-->Legacy\nPersistence\nTech:
        Temporary\nAbstraction\n(ormToggle=new)->New\nPersistence\nTech: getDao
        Legacy\nPersistence\nTech-->Legacy\nShopping\nCart DAO:
        New\nPersistence\nTech->New\nShopping\nCart DAO: findOrCreate
        New\nShopping\nCart DAO->Temporary\nAbstraction\n(ormToggle=new): here it is
        Temporary\nAbstraction\n(ormToggle=new)->New\nShopping\nCart DAO: save this
        New\nShopping\nCart DAO->Temporary\nAbstraction\n(ormToggle=new): yup, saved
        Temporary\nAbstraction\n(ormToggle=new)->Shopping\nCart: added
        Shopping\nCart->Add To\nShoppingCart\nRoute: added
        ]]></source><desc></desc><defs><marker viewBox="0 0 5 5" markerWidth="5" markerHeight="5" orient="auto" refX="5" refY="2.5" id="markerArrowBlock"><path d="M 0 0 L 5 2.5 L 0 5 z"></path></marker><marker viewBox="0 0 9.6 16" markerWidth="4" markerHeight="16" orient="auto" refX="9.6" refY="8" id="markerArrowOpen"><path d="M 9.6,8 1.9,16 0,13.7 5.7,8 0,2.2 1.9,0 9.6,8 z"></path></marker></defs><g class="title"></g><g class="actor"><rect x="10" y="20" width="137.1" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="21" y="45" ><tspan x="20">Add To</tspan><tspan dy="1.2em" x="20">ShoppingCart</tspan><tspan dy="1.2em" x="20">Route</tspan></text></g><g class="actor"><rect x="10" y="508.4" width="137.1" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="21" y="533.4" ><tspan x="20">Add To</tspan><tspan dy="1.2em" x="20">ShoppingCart</tspan><tspan dy="1.2em" x="20">Route</tspan></text></g><line x1="78.5" x2="78.5" y1="97.4" y2="508.4" style="stroke-width: 2;" stroke="#000000" fill="none"></line><g class="actor"><rect x="167.1" y="20" width="98.8" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="178.1" y="54.6" ><tspan x="177.1">Shopping</tspan><tspan dy="1.2em" x="177.1">Cart</tspan></text></g><g class="actor"><rect x="167.1" y="508.4" width="98.8" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="178.1" y="543.0" ><tspan x="177.1">Shopping</tspan><tspan dy="1.2em" x="177.1">Cart</tspan></text></g><line x1="216.5" x2="216.5" y1="97.4" y2="508.4" style="stroke-width: 2;" stroke="#000000" fill="none"></line><g class="actor"><rect x="286" y="20" width="166" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="297" y="45" ><tspan x="296">Temporary</tspan><tspan dy="1.2em" x="296">Abstraction</tspan><tspan dy="1.2em" x="296">(ormToggle=new)</tspan></text></g><g class="actor"><rect x="286" y="508.4" width="166" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="297" y="533.4" ><tspan x="296">Temporary</tspan><tspan dy="1.2em" x="296">Abstraction</tspan><tspan dy="1.2em" x="296">(ormToggle=new)</tspan></text></g><line x1="369" x2="369" y1="97.4" y2="508.4" style="stroke-width: 2;" stroke="#000000" fill="none"></line><g class="actor"><rect x="472" y="20" width="127.5" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="483" y="45" ><tspan x="482">Legacy</tspan><tspan dy="1.2em" x="482">Persistence</tspan><tspan dy="1.2em" x="482">Tech</tspan></text></g><g class="actor"><rect x="472" y="508.4" width="127.5" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="483" y="533.4" ><tspan x="482">Legacy</tspan><tspan dy="1.2em" x="482">Persistence</tspan><tspan dy="1.2em" x="482">Tech</tspan></text></g><line x1="535.7" x2="535.7" y1="97.4" y2="508.4" style="stroke-width: 2;" stroke="#000000" fill="none"></line><g class="actor"><rect x="619.5" y="20" width="127.5" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="630.5" y="45" ><tspan x="629.5">New</tspan><tspan dy="1.2em" x="629.5">Persistence</tspan><tspan dy="1.2em" x="629.5">Tech</tspan></text></g><g class="actor"><rect x="619.5" y="508.4" width="127.5" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="630.5" y="533.4" ><tspan x="629.5">New</tspan><tspan dy="1.2em" x="629.5">Persistence</tspan><tspan dy="1.2em" x="629.5">Tech</tspan></text></g><line x1="683.3" x2="683.3" y1="97.4" y2="508.4" style="stroke-width: 2;" stroke="#000000" fill="none"></line><g class="actor"><rect x="767.1" y="20" width="98.8" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="778.1" y="45" ><tspan x="777.1">Legacy</tspan><tspan dy="1.2em" x="777.1">Shopping</tspan><tspan dy="1.2em" x="777.1">Cart DAO</tspan></text></g><g class="actor"><rect x="767.1" y="508.4" width="98.8" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="778.1" y="533.4" ><tspan x="777.1">Legacy</tspan><tspan dy="1.2em" x="777.1">Shopping</tspan><tspan dy="1.2em" x="777.1">Cart DAO</tspan></text></g><line x1="816.5" x2="816.5" y1="97.4" y2="508.4" style="stroke-width: 2;" stroke="#000000" fill="none"></line><g class="actor"><rect x="886" y="20" width="98.8" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="897" y="45" ><tspan x="896">New</tspan><tspan dy="1.2em" x="896">Shopping</tspan><tspan dy="1.2em" x="896">Cart DAO</tspan></text></g><g class="actor"><rect x="886" y="508.4" width="98.8" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="897" y="533.4" ><tspan x="896">New</tspan><tspan dy="1.2em" x="896">Shopping</tspan><tspan dy="1.2em" x="896">Cart DAO</tspan></text></g><line x1="935.4" x2="935.4" y1="97.4" y2="508.4" style="stroke-width: 2;" stroke="#000000" fill="none"></line><g class="signal"><text x="114" y="127.9" ><tspan x="113">addItem</tspan></text><line x1="78.5" x2="216.5" y1="136.4" y2="136.4" style="stroke-width: 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="259.2" y="166.9" ><tspan x="258.2">addItem</tspan></text><line x1="216.5" x2="369" y1="175.4" y2="175.4" style="stroke-width: 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="452.3" y="200.4" ><tspan x="452.3"></tspan></text><line x1="369" x2="535.7" y1="195.4" y2="195.4" style="stroke-width: 2; stroke-dasharray: 6, 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="497.3" y="225.9" ><tspan x="496.3">getDao</tspan></text><line x1="369" x2="683.3" y1="234.4" y2="234.4" style="stroke-width: 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="676.1" y="259.4" ><tspan x="676.1"></tspan></text><line x1="535.7" x2="816.5" y1="254.4" y2="254.4" style="stroke-width: 2; stroke-dasharray: 6, 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="751.8" y="284.9" ><tspan x="750.8">findOrCreate</tspan></text><line x1="683.3" x2="935.4" y1="293.4" y2="293.4" style="stroke-width: 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="604.2" y="323.9" ><tspan x="603.2">here it is</tspan></text><line x1="935.4" x2="369" y1="332.4" y2="332.4" style="stroke-width: 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="609" y="362.9" ><tspan x="608">save this</tspan></text><line x1="369" x2="935.4" y1="371.4" y2="371.4" style="stroke-width: 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="604.2" y="401.9" ><tspan x="603.2">yup, saved</tspan></text><line x1="935.4" x2="369" y1="410.4" y2="410.4" style="stroke-width: 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="268.7" y="440.9" ><tspan x="267.7">added</tspan></text><line x1="369" x2="216.5" y1="449.4" y2="449.4" style="stroke-width: 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="123.5" y="479.9" ><tspan x="122.5">added</tspan></text><line x1="216.5" x2="78.5" y1="488.4" y2="488.4" style="stroke-width: 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g></svg>

    <p class="flow-text">That could literally be code: </p>

<pre style="background-color: gainsboro; padding: 0.75%"><code>if (useNewPersistenceTech) {
    persistenceFactory = new NewPersistenceFactory();
} else {
    persistenceFactory = new OldPersistenceFactory();
}</code></pre>

    <p class="flow-text">But it is more likely to be outside code in a YAML, XML, JSON or properties file (local or remote), like this (or better):</p>

    <pre style="background-color: gainsboro; padding: 0.75%"><code># persistenceFactoryClassName=com.yourcompany.yourapp.OldPersistenceFactory
persistenceFactoryClassName=com.yourcompany.yourapp.NewPersistenceFactory</code></pre>

    <p class="flow-text">And code that used that at boot time:</p>

    <pre style="background-color: gainsboro; padding: 0.75%"><code>pfClassName props.getProperty("persistenceFactoryClassName");
persistenceFactory = instantiateFrom(pfClassName);</code></pre>

    <h2>5. Everyone else sees the old persistence tech</h2>

    <svg xmlns="http://www.w3.org/2000/svg" width="1014" height="605" xmlns:xlink="http://www.w3.org/1999/xlink"><source><![CDATA[Add To\nShoppingCart\nRoute -> Shopping\nCart: addItem
        Shopping\nCart->Temporary\nAbstraction\n(ormToggle=old): addItem
        Temporary\nAbstraction\n(ormToggle=old)->Legacy\nPersistence\nTech:
        Temporary\nAbstraction\n(ormToggle=old)-->New\nPersistence\nTech: getDao
        Legacy\nPersistence\nTech->Legacy\nShopping\nCart DAO:
        New\nPersistence\nTech-->New\nShopping\nCart DAO: findOrCreate
        Legacy\nShopping\nCart DAO->Temporary\nAbstraction\n(ormToggle=old): here it is
        Temporary\nAbstraction\n(ormToggle=old)->Legacy\nShopping\nCart DAO: save this
        Legacy\nShopping\nCart DAO->Temporary\nAbstraction\n(ormToggle=old): yup, saved
        Temporary\nAbstraction\n(ormToggle=old)->Shopping\nCart: added
        Shopping\nCart->Add To\nShoppingCart\nRoute: added
        ]]></source><desc></desc><defs><marker viewBox="0 0 5 5" markerWidth="5" markerHeight="5" orient="auto" refX="5" refY="2.5" id="markerArrowBlock"><path d="M 0 0 L 5 2.5 L 0 5 z"></path></marker><marker viewBox="0 0 9.6 16" markerWidth="4" markerHeight="16" orient="auto" refX="9.6" refY="8" id="markerArrowOpen"><path d="M 9.6,8 1.9,16 0,13.7 5.7,8 0,2.2 1.9,0 9.6,8 z"></path></marker></defs><g class="title"></g><g class="actor"><rect x="10" y="20" width="137.1" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="21" y="45" ><tspan x="20">Add To</tspan><tspan dy="1.2em" x="20">ShoppingCart</tspan><tspan dy="1.2em" x="20">Route</tspan></text></g><g class="actor"><rect x="10" y="508.4" width="137.1" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="21" y="533.4" ><tspan x="20">Add To</tspan><tspan dy="1.2em" x="20">ShoppingCart</tspan><tspan dy="1.2em" x="20">Route</tspan></text></g><line x1="78.5" x2="78.5" y1="97.4" y2="508.4" style="stroke-width: 2;" stroke="#000000" fill="none"></line><g class="actor"><rect x="167.1" y="20" width="98.8" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="178.1" y="54.6" ><tspan x="177.1">Shopping</tspan><tspan dy="1.2em" x="177.1">Cart</tspan></text></g><g class="actor"><rect x="167.1" y="508.4" width="98.8" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="178.1" y="543.0" ><tspan x="177.1">Shopping</tspan><tspan dy="1.2em" x="177.1">Cart</tspan></text></g><line x1="216.5" x2="216.5" y1="97.4" y2="508.4" style="stroke-width: 2;" stroke="#000000" fill="none"></line><g class="actor"><rect x="286" y="20" width="166" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="297" y="45" ><tspan x="296">Temporary</tspan><tspan dy="1.2em" x="296">Abstraction</tspan><tspan dy="1.2em" x="296">(ormToggle=old)</tspan></text></g><g class="actor"><rect x="286" y="508.4" width="166" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="297" y="533.4" ><tspan x="296">Temporary</tspan><tspan dy="1.2em" x="296">Abstraction</tspan><tspan dy="1.2em" x="296">(ormToggle=old)</tspan></text></g><line x1="369" x2="369" y1="97.4" y2="508.4" style="stroke-width: 2;" stroke="#000000" fill="none"></line><g class="actor"><rect x="472" y="20" width="127.5" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="483" y="45" ><tspan x="482">Legacy</tspan><tspan dy="1.2em" x="482">Persistence</tspan><tspan dy="1.2em" x="482">Tech</tspan></text></g><g class="actor"><rect x="472" y="508.4" width="127.5" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="483" y="533.4" ><tspan x="482">Legacy</tspan><tspan dy="1.2em" x="482">Persistence</tspan><tspan dy="1.2em" x="482">Tech</tspan></text></g><line x1="535.7" x2="535.7" y1="97.4" y2="508.4" style="stroke-width: 2;" stroke="#000000" fill="none"></line><g class="actor"><rect x="619.5" y="20" width="127.5" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="630.5" y="45" ><tspan x="629.5">New</tspan><tspan dy="1.2em" x="629.5">Persistence</tspan><tspan dy="1.2em" x="629.5">Tech</tspan></text></g><g class="actor"><rect x="619.5" y="508.4" width="127.5" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="630.5" y="533.4" ><tspan x="629.5">New</tspan><tspan dy="1.2em" x="629.5">Persistence</tspan><tspan dy="1.2em" x="629.5">Tech</tspan></text></g><line x1="683.3" x2="683.3" y1="97.4" y2="508.4" style="stroke-width: 2;" stroke="#000000" fill="none"></line><g class="actor"><rect x="767.1" y="20" width="98.8" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="778.1" y="45" ><tspan x="777.1">Legacy</tspan><tspan dy="1.2em" x="777.1">Shopping</tspan><tspan dy="1.2em" x="777.1">Cart DAO</tspan></text></g><g class="actor"><rect x="767.1" y="508.4" width="98.8" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="778.1" y="533.4" ><tspan x="777.1">Legacy</tspan><tspan dy="1.2em" x="777.1">Shopping</tspan><tspan dy="1.2em" x="777.1">Cart DAO</tspan></text></g><line x1="816.5" x2="816.5" y1="97.4" y2="508.4" style="stroke-width: 2;" stroke="#000000" fill="none"></line><g class="actor"><rect x="886" y="20" width="98.8" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="897" y="45" ><tspan x="896">New</tspan><tspan dy="1.2em" x="896">Shopping</tspan><tspan dy="1.2em" x="896">Cart DAO</tspan></text></g><g class="actor"><rect x="886" y="508.4" width="98.8" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="897" y="533.4" ><tspan x="896">New</tspan><tspan dy="1.2em" x="896">Shopping</tspan><tspan dy="1.2em" x="896">Cart DAO</tspan></text></g><line x1="935.4" x2="935.4" y1="97.4" y2="508.4" style="stroke-width: 2;" stroke="#000000" fill="none"></line><g class="signal"><text x="114" y="127.9" ><tspan x="113">addItem</tspan></text><line x1="78.5" x2="216.5" y1="136.4" y2="136.4" style="stroke-width: 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="259.2" y="166.9" ><tspan x="258.2">addItem</tspan></text><line x1="216.5" x2="369" y1="175.4" y2="175.4" style="stroke-width: 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="452.3" y="200.4" ><tspan x="452.3"></tspan></text><line x1="369" x2="535.7" y1="195.4" y2="195.4" style="stroke-width: 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="497.3" y="225.9" ><tspan x="496.3">getDao</tspan></text><line x1="369" x2="683.3" y1="234.4" y2="234.4" style="stroke-width: 2; stroke-dasharray: 6, 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="676.1" y="259.4" ><tspan x="676.1"></tspan></text><line x1="535.7" x2="816.5" y1="254.4" y2="254.4" style="stroke-width: 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="751.8" y="284.9" ><tspan x="750.8">findOrCreate</tspan></text><line x1="683.3" x2="935.4" y1="293.4" y2="293.4" style="stroke-width: 2; stroke-dasharray: 6, 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="544.7" y="323.9" ><tspan x="543.7">here it is</tspan></text><line x1="816.5" x2="369" y1="332.4" y2="332.4" style="stroke-width: 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="549.5" y="362.9" ><tspan x="548.5">save this</tspan></text><line x1="369" x2="816.5" y1="371.4" y2="371.4" style="stroke-width: 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="544.7" y="401.9" ><tspan x="543.7">yup, saved</tspan></text><line x1="816.5" x2="369" y1="410.4" y2="410.4" style="stroke-width: 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="268.7" y="440.9" ><tspan x="267.7">added</tspan></text><line x1="369" x2="216.5" y1="449.4" y2="449.4" style="stroke-width: 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="123.5" y="479.9" ><tspan x="122.5">added</tspan></text><line x1="216.5" x2="78.5" y1="488.4" y2="488.4" style="stroke-width: 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g></svg>

    <p class="flow-text">And indeed "everyone else" also means QA/UAT/live deployments too.</p>

    <h2>6. Repeat tens or hundreds of times until there are two of everything</h2>

    <p class="flow-text">The point was that the "change that was going to take a while" was going to span a few releases, and happen
    concurrently with the development other business functionality. Getting the first example done using branch by
        abstraction was a prerogative. That included the writing of unit and integration tests for it. Best of all
    would be forking of the unit/integration tests from the old implementation, but I'm never surprised to find
    that there were next to none. </p>

    <p class="flow-text">It is also worth reminding here that this is methodical. As developer, you're going to complete one and
        commit/push. Everything you code will be with the assumption that it is going to go live but turned off
        in production (or compiled out).  You can't even expect that other developers working on functional deliverables
        won't concurrently create new classes in the old technology. You may insist that they writ tests though if
        they are adding to your backlog.</p>

    <svg xmlns="http://www.w3.org/2000/svg" width="1047" height="644" xmlns:xlink="http://www.w3.org/1999/xlink"><source><![CDATA[Some\nRoute -> Other\nBiz—logic\nComponents: some biz op
        Other\nBiz—logic\nComponents->Temporary\nAbstraction\n(ormToggle=new): some biz op
        Temporary\nAbstraction\n(ormToggle=new)-->Legacy\nPersistence\nTech:
        Temporary\nAbstraction\n(ormToggle=new)->New\nPersistence\nTech: getDao
        Legacy\nPersistence\nTech-->All Other\nLegacy\nDAOs (one\nat a time):
        New\nPersistence\nTech->All Other\New\nDAOs (one\nat a time): findOrCreate
        All Other\New\nDAOs (one\nat a time)->Temporary\nAbstraction\n(ormToggle=new): here it is
        Temporary\nAbstraction\n(ormToggle=new)->All Other\New\nDAOs (one\nat a time): save this
        All Other\New\nDAOs (one\nat a time)->Temporary\nAbstraction\n(ormToggle=new): yup, saved
        Temporary\nAbstraction\n(ormToggle=new)->Other\nBiz—logic\nComponents: did it
        Other\nBiz—logic\nComponents->Some\nRoute: did it]]></source><desc></desc><defs><marker viewBox="0 0 5 5" markerWidth="5" markerHeight="5" orient="auto" refX="5" refY="2.5" id="markerArrowBlock"><path d="M 0 0 L 5 2.5 L 0 5 z"></path></marker><marker viewBox="0 0 9.6 16" markerWidth="4" markerHeight="16" orient="auto" refX="9.6" refY="8" id="markerArrowOpen"><path d="M 9.6,8 1.9,16 0,13.7 5.7,8 0,2.2 1.9,0 9.6,8 z"></path></marker></defs><g class="title"></g><g class="actor"><rect x="10" y="20" width="70" height="96.6" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="21" y="64.2" ><tspan x="20">Some</tspan><tspan dy="1.2em" x="20">Route</tspan></text></g><g class="actor"><rect x="10" y="527.6" width="70" height="96.6" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="21" y="571.8" ><tspan x="20">Some</tspan><tspan dy="1.2em" x="20">Route</tspan></text></g><line x1="45" x2="45" y1="116.6" y2="527.6" style="stroke-width: 2;" stroke="#000000" fill="none"></line><g class="actor"><rect x="113.5" y="20" width="118" height="96.6" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="124.5" y="54.6" ><tspan x="123.5">Other</tspan><tspan dy="1.2em" x="123.5">Biz—logic</tspan><tspan dy="1.2em" x="123.5">Components</tspan></text></g><g class="actor"><rect x="113.5" y="527.6" width="118" height="96.6" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="124.5" y="562.2" ><tspan x="123.5">Other</tspan><tspan dy="1.2em" x="123.5">Biz—logic</tspan><tspan dy="1.2em" x="123.5">Components</tspan></text></g><line x1="172.5" x2="172.5" y1="116.6" y2="527.6" style="stroke-width: 2;" stroke="#000000" fill="none"></line><g class="actor"><rect x="251.5" y="20" width="166" height="96.6" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="262.5" y="54.6" ><tspan x="261.5">Temporary</tspan><tspan dy="1.2em" x="261.5">Abstraction</tspan><tspan dy="1.2em" x="261.5">(ormToggle=new)</tspan></text></g><g class="actor"><rect x="251.5" y="527.6" width="166" height="96.6" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="262.5" y="562.2" ><tspan x="261.5">Temporary</tspan><tspan dy="1.2em" x="261.5">Abstraction</tspan><tspan dy="1.2em" x="261.5">(ormToggle=new)</tspan></text></g><line x1="334.5" x2="334.5" y1="116.6" y2="527.6" style="stroke-width: 2;" stroke="#000000" fill="none"></line><g class="actor"><rect x="437.5" y="20" width="127.5" height="96.6" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="448.5" y="54.6" ><tspan x="447.5">Legacy</tspan><tspan dy="1.2em" x="447.5">Persistence</tspan><tspan dy="1.2em" x="447.5">Tech</tspan></text></g><g class="actor"><rect x="437.5" y="527.6" width="127.5" height="96.6" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="448.5" y="562.2" ><tspan x="447.5">Legacy</tspan><tspan dy="1.2em" x="447.5">Persistence</tspan><tspan dy="1.2em" x="447.5">Tech</tspan></text></g><line x1="501.3" x2="501.3" y1="116.6" y2="527.6" style="stroke-width: 2;" stroke="#000000" fill="none"></line><g class="actor"><rect x="585.1" y="20" width="127.5" height="96.6" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="596.1" y="54.6" ><tspan x="595.1">New</tspan><tspan dy="1.2em" x="595.1">Persistence</tspan><tspan dy="1.2em" x="595.1">Tech</tspan></text></g><g class="actor"><rect x="585.1" y="527.6" width="127.5" height="96.6" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="596.1" y="562.2" ><tspan x="595.1">New</tspan><tspan dy="1.2em" x="595.1">Persistence</tspan><tspan dy="1.2em" x="595.1">Tech</tspan></text></g><line x1="648.9" x2="648.9" y1="116.6" y2="527.6" style="stroke-width: 2;" stroke="#000000" fill="none"></line><g class="actor"><rect x="732.7" y="20" width="118" height="96.6" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="743.7" y="45" ><tspan x="742.7">All Other</tspan><tspan dy="1.2em" x="742.7">Legacy</tspan><tspan dy="1.2em" x="742.7">DAOs (one</tspan><tspan dy="1.2em" x="742.7">at a time)</tspan></text></g><g class="actor"><rect x="732.7" y="527.6" width="118" height="96.6" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="743.7" y="552.6" ><tspan x="742.7">All Other</tspan><tspan dy="1.2em" x="742.7">Legacy</tspan><tspan dy="1.2em" x="742.7">DAOs (one</tspan><tspan dy="1.2em" x="742.7">at a time)</tspan></text></g><line x1="791.7" x2="791.7" y1="116.6" y2="527.6" style="stroke-width: 2;" stroke="#000000" fill="none"></line><g class="actor"><rect x="870.7" y="20" width="146.8" height="96.6" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="881.7" y="54.6" ><tspan x="880.7">All Other\New</tspan><tspan dy="1.2em" x="880.7">DAOs (one</tspan><tspan dy="1.2em" x="880.7">at a time)</tspan></text></g><g class="actor"><rect x="870.7" y="527.6" width="146.8" height="96.6" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="881.7" y="562.2" ><tspan x="880.7">All Other\New</tspan><tspan dy="1.2em" x="880.7">DAOs (one</tspan><tspan dy="1.2em" x="880.7">at a time)</tspan></text></g><line x1="944.1" x2="944.1" y1="116.6" y2="527.6" style="stroke-width: 2;" stroke="#000000" fill="none"></line><g class="signal"><text x="56" y="147.1" ><tspan x="55">some biz op</tspan></text><line x1="45" x2="172.5" y1="155.6" y2="155.6" style="stroke-width: 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="200.7" y="186.1" ><tspan x="199.7">some biz op</tspan></text><line x1="172.5" x2="334.5" y1="194.6" y2="194.6" style="stroke-width: 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="417.9" y="219.6" ><tspan x="417.9"></tspan></text><line x1="334.5" x2="501.3" y1="214.6" y2="214.6" style="stroke-width: 2; stroke-dasharray: 6, 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="462.9" y="245.1" ><tspan x="461.9">getDao</tspan></text><line x1="334.5" x2="648.9" y1="253.6" y2="253.6" style="stroke-width: 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="646.5" y="278.6" ><tspan x="646.5"></tspan></text><line x1="501.3" x2="791.7" y1="273.6" y2="273.6" style="stroke-width: 2; stroke-dasharray: 6, 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="738.9" y="304.1" ><tspan x="737.9">findOrCreate</tspan></text><line x1="648.9" x2="944.1" y1="312.6" y2="312.6" style="stroke-width: 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="591.3" y="343.1" ><tspan x="590.3">here it is</tspan></text><line x1="944.1" x2="334.5" y1="351.6" y2="351.6" style="stroke-width: 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="596.1" y="382.1" ><tspan x="595.1">save this</tspan></text><line x1="334.5" x2="944.1" y1="390.6" y2="390.6" style="stroke-width: 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="591.3" y="421.1" ><tspan x="590.3">yup, saved</tspan></text><line x1="944.1" x2="334.5" y1="429.6" y2="429.6" style="stroke-width: 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="224.7" y="460.1" ><tspan x="223.7">did it</tspan></text><line x1="334.5" x2="172.5" y1="468.6" y2="468.6" style="stroke-width: 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="80" y="499.1" ><tspan x="79">did it</tspan></text><line x1="172.5" x2="45" y1="507.6" y2="507.6" style="stroke-width: 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g></svg>

    <p class="flow-text">As you're coding/committing/pushing small parts of this work towards completion, at some point you're going to
    try to bring up the app itself and click through it in an exploratory way. You'll also be wanting to see that the
    UI functional tests (Selenium, etc) are still passing too. If you're not yet complete on the migration, then these
    experiments can help you to work out which class/component to work on next. The exercise can also help with
        the calculation of percentage complete for the whole piece of work, which non-developers will be pushing you
        for.  Make sure you've already got agreement that it is safe to change estimates as you go. Maybe even more than
        once. Reminding managers that this methodical procedure can be paused and resumed helps too.

    <h2>7. Lastly remove the abstraction (and the old implementation)</h2>

    <p class="flow-text">You will go properly live with a toggle flip, after testing and a signoff in UAT. You'll have practiced flipping
    that toggle back to "old" in UAT after an initial deployment to "new". You will confirm both work so that you can assure
        execs that you can do the same in production if needs be.</p>

    <p class="flow-text">After being live for a couple of weeks, you will remove the old implementation </p>

    <p class="flow-text">Maybe immediately after that, but it could also be after a <i>another</i> couple of weeks, you'll remove the old
        abstraction itself too(commit/push/go-live), ending up with:</p>

    <svg xmlns="http://www.w3.org/2000/svg" width="566" height="487" xmlns:xlink="http://www.w3.org/1999/xlink"><source><![CDATA[Add To\nShoppingCart\nRoute -> Shopping\nCart: addItem
        Shopping\nCart->Your ~New~\nPersistence\nTech: getDao
        Your ~New~\nPersistence\nTech->~New~\nShopping\nCart DAO: findOrCreate
        ~New~\nShopping\nCart DAO->Shopping\nCart: here it is
        Shopping\nCart->~New~\nShopping\nCart DAO: save this
        ~New~\nShopping\nCart DAO->Shopping\nCart: yup, saved
        Shopping\nCart->Add To\nShoppingCart\nRoute: added]]></source><desc></desc><defs><marker viewBox="0 0 5 5" markerWidth="5" markerHeight="5" orient="auto" refX="5" refY="2.5" id="markerArrowBlock"><path d="M 0 0 L 5 2.5 L 0 5 z"></path></marker><marker viewBox="0 0 9.6 16" markerWidth="4" markerHeight="16" orient="auto" refX="9.6" refY="8" id="markerArrowOpen"><path d="M 9.6,8 1.9,16 0,13.7 5.7,8 0,2.2 1.9,0 9.6,8 z"></path></marker></defs><g class="title"></g><g class="actor"><rect x="10" y="20" width="137.1" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="21" y="45" ><tspan x="20">Add To</tspan><tspan dy="1.2em" x="20">ShoppingCart</tspan><tspan dy="1.2em" x="20">Route</tspan></text></g><g class="actor"><rect x="10" y="390.4" width="137.1" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="21" y="415.4" ><tspan x="20">Add To</tspan><tspan dy="1.2em" x="20">ShoppingCart</tspan><tspan dy="1.2em" x="20">Route</tspan></text></g><line x1="78.5" x2="78.5" y1="97.4" y2="390.4" style="stroke-width: 2;" stroke="#000000" fill="none"></line><g class="actor"><rect x="167.1" y="20" width="98.8" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="178.1" y="54.6" ><tspan x="177.1">Shopping</tspan><tspan dy="1.2em" x="177.1">Cart</tspan></text></g><g class="actor"><rect x="167.1" y="390.4" width="98.8" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="178.1" y="425.0" ><tspan x="177.1">Shopping</tspan><tspan dy="1.2em" x="177.1">Cart</tspan></text></g><line x1="216.5" x2="216.5" y1="97.4" y2="390.4" style="stroke-width: 2;" stroke="#000000" fill="none"></line><g class="actor"><rect x="286" y="20" width="127.5" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="297" y="45" ><tspan x="296">Your ~New~</tspan><tspan dy="1.2em" x="296">Persistence</tspan><tspan dy="1.2em" x="296">Tech</tspan></text></g><g class="actor"><rect x="286" y="390.4" width="127.5" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="297" y="415.4" ><tspan x="296">Your ~New~</tspan><tspan dy="1.2em" x="296">Persistence</tspan><tspan dy="1.2em" x="296">Tech</tspan></text></g><line x1="349.7" x2="349.7" y1="97.4" y2="390.4" style="stroke-width: 2;" stroke="#000000" fill="none"></line><g class="actor"><rect x="437.5" y="20" width="98.8" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="448.5" y="45" ><tspan x="447.5">~New~</tspan><tspan dy="1.2em" x="447.5">Shopping</tspan><tspan dy="1.2em" x="447.5">Cart DAO</tspan></text></g><g class="actor"><rect x="437.5" y="390.4" width="98.8" height="77.4" style="stroke-width: 2;" stroke="#000000" fill="#ffffff"></rect><text x="448.5" y="415.4" ><tspan x="447.5">~New~</tspan><tspan dy="1.2em" x="447.5">Shopping</tspan><tspan dy="1.2em" x="447.5">Cart DAO</tspan></text></g><line x1="486.9" x2="486.9" y1="97.4" y2="390.4" style="stroke-width: 2;" stroke="#000000" fill="none"></line><g class="signal"><text x="114" y="127.9" ><tspan x="113">addItem</tspan></text><line x1="78.5" x2="216.5" y1="136.4" y2="136.4" style="stroke-width: 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="254.3" y="166.9" ><tspan x="253.3">getDao</tspan></text><line x1="216.5" x2="349.7" y1="175.4" y2="175.4" style="stroke-width: 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="360.7" y="205.9" ><tspan x="359.7">findOrCreate</tspan></text><line x1="349.7" x2="486.9" y1="214.4" y2="214.4" style="stroke-width: 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="303.7" y="244.9" ><tspan x="302.7">here it is</tspan></text><line x1="486.9" x2="216.5" y1="253.4" y2="253.4" style="stroke-width: 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="308.5" y="283.9" ><tspan x="307.5">save this</tspan></text><line x1="216.5" x2="486.9" y1="292.4" y2="292.4" style="stroke-width: 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="303.7" y="322.9" ><tspan x="302.7">yup, saved</tspan></text><line x1="486.9" x2="216.5" y1="331.4" y2="331.4" style="stroke-width: 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g><g class="signal"><text x="123.5" y="361.9" ><tspan x="122.5">added</tspan></text><line x1="216.5" x2="78.5" y1="370.4" y2="370.4" style="stroke-width: 2; marker-end: url(#markerArrowBlock);" stroke="#000000" fill="none"></line></g></svg>

    <p class="flow-text">As previously mentioned, this last is the characterizing difference to any other use of an abstraction in the codebase,
        and symbolic of the merge back had the terrible decision to been made to do the lengthy non-functional change on a
        branch and bring it back to trunk/master when complete.</p>

</div>

<footer class="page-footer">
    <div class="container">
        <p class="flow-text">This site was put together by New York based <a href="https://hammant.org/">Paul Hammant</a>
            who did the pioneering work at a client (Bank of America's GFX
            group in Chicago in '05/'06) and wrote the first article on Branch by Abstraction in 2007 based on that work,
            the artwork and message from which was included in Jez Humble and Dave Farley's
            <a href="https://www.amazon.com/dp/0321601912?tag=contindelive-20">best-selling Continuous Delivery book</a>
            in 2010.</p>
        <p class="flow-text">Paul visits enterprises to help them plan their migrations from crazy branching models (and
            slower than desired release cadence) to <a href="https://trunkbaseddevelopment.com/">Trunk-Based Development</a>
            with feature flags/toggles <b>and of course Branch by Abstraction</b>. See <a
                    href="https://devops.paulhammant.com">http://devops.paulhammant.com</a> for more details.</p>
    </div>
    <div class="footer-copyright">
        <div class="container">
            &copy; 2018, Paul Hammant
        </div>
    </div>
</footer>


<script type="text/javascript">

    var t0 = performance.now();

    var svgs = $("svg");

    svgs.find("*").removeAttr("stroke");
    svgs.find("g").attr("stroke", "black");
    svgs.find("line").attr("stroke", "#000000");

    function textExactlyEquals(txt) {
        // predicate style
        return function(node) {
            return $(this).text() === txt;
        }
    }

    var colorizeNewAndLegacyBoxesAndAssociatedLine =  function(elem, yesColor, noColor) {

        $(elem).find('tspan:contains("New")').filter(textExactlyEquals("New"))
            .parent().parent().attr('stroke', yesColor).next().attr('stroke', yesColor);

        $(elem).find('tspan:contains("Legacy")').filter(textExactlyEquals("Legacy"))
            .parent().parent().attr('stroke', noColor).next().attr('stroke', noColor);

        $(elem).find('tspan:contains("Legacy")').filter(textExactlyEquals("Legacy"))
            .parent().parent().next().filter('line').attr('stroke', noColor).attr('stroke-dasharray', '5, 5');
    };

    colorizeNewAndLegacyBoxesAndAssociatedLine(svgs[3], 'lime', 'lightgrey');
    colorizeNewAndLegacyBoxesAndAssociatedLine(svgs[4], 'lightgrey', 'lime');
    colorizeNewAndLegacyBoxesAndAssociatedLine(svgs[5], 'lime', 'lightgrey');

    $( "line[style*='stroke-dasharray']" ).attr('stroke', 'lightgrey');

    svgs.each(function(i, item) {
        var img_width = $(item).width();
        var img_height = $(item).height();
        var div_width = $(item).parent().width();
        if(img_width < div_width){
            //IMAGE IS NARROWER THAN CONTAINER WIDTH - CENTER IT HORIZONTALLY
            var newMargin = (div_width-img_width)/2+'px';
            $(item).attr({'style': "font-size: 16px; font-family: Andale Mono, monospace; margin-left: " + newMargin});
        } else if(img_width > div_width) {
            //IMAGE IS GREATER THAN CONTAINER HEIGHT - VIEWBOX NEEDED
            $(item).removeAttr("width");
            $(item).removeAttr("height");
            $(item).attr({'style': "width: 100%; height: auto; font-size: 16px; font-family: Andale Mono, monospace;"});
            $(item).attr({'preserveAspectRatio': "xMinYMin meet"});
            $(item).attr({'viewBox': "0 0 " + img_width + " " + img_height});
        }
        $(item).addClass("z-depth-2");

    });

    // $('tspan:contains("Your New")').filter(textExactlyEquals("Your New")).parent().parent().attr('stroke', 'blue')
    //     .next().attr('stroke', 'blue');

    $(svgs[1]).find('tspan:contains("Abstraction.")').filter(textExactlyEquals("Abstraction."))
        .each(function (i, item) {
            $(this).text("Abstraction");
        }).parent().parent().attr('stroke', 'blue')
        .next().attr('stroke', 'blue');

    $(svgs[2]).find('tspan:contains("Legacy.")').filter(textExactlyEquals("Legacy."))
        .each(function (i, item) {
            $(this).text("Legacy");
        }).parent().parent().attr('stroke', 'blue')
        .next().attr('stroke', 'blue');

    $(svgs[3]).find('tspan:contains("(ormToggle=new)")').filter(textExactlyEquals("(ormToggle=new)")).attr('stroke', 'lime');
    $(svgs[5]).find('tspan:contains("(ormToggle=new)")').filter(textExactlyEquals("(ormToggle=new)")).attr('stroke', 'lime');

    $(svgs[4]).find('tspan:contains("(ormToggle=old)")').filter(textExactlyEquals("(ormToggle=old)")).attr('stroke', 'lime');


    const LINE_THROUGH = "text-decoration: line-through";

    $(svgs[6]).find('tspan:contains("~New~")').filter(textExactlyEquals("~New~"))
        .attr('stroke', 'blue').text("New").attr("style", LINE_THROUGH);
    $(svgs[6]).find('tspan:contains("Your ~New~")').filter(textExactlyEquals("Your ~New~"))
        .each(function () {
            // JQuery, today, doesn't play well with adding SVG elements - tricks required
            $(this).parent().prepend($(this).clone().text("Your"));
            $(this).text("New").attr("x", "340").text("New").attr('stroke', 'blue').attr("style", LINE_THROUGH);
        });

    var t1 = performance.now();
    document.write("<p>JQuery bits took: " + (t1 - t0) + " milliseconds.</p>")

</script>

</main>

<script>
    (function($){
        $(function(){
            $('select').not('.disabled').material_select();
        });
    })(jQuery);
</script>
</body>

</html>
